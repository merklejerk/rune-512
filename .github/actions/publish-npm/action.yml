name: publish to npm
inputs:
  token:
    description: NPM token.
    required: true
  path:
    description: 'Path to the package to publish'
    required: true
  noop:
    description: 'If true, do not actually publish'
    required: false
    default: 'false'
runs:
  using: 'composite'
  steps:
    - if: ${{ !inputs.noop }}
      uses: actions/setup-node@v4
      with:
        node-version: 21
        registry-url: https://registry.npmjs.org/
    - if: ${{ !inputs.noop }}
      shell: bash
      run: |
        cd ${{ inputs.path }} && \
        echo "publishing typescript implementation" at ${{ inputs.path }} && \
        npm i -D && \
        npm run build
    - if: ${{ !inputs.noop }}
      shell: bash
      run: npm publish --access public
      env:
        NODE_AUTH_TOKEN: ${{ inputs.token }}
    - shell: bash
      run: echo "published=" ${{ !inputs.noop }} >> $GITHUB_OUTPUT

  
